<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking - Quiz Cristiano</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Ranking de Quiz Cristiano - Compite con otros jugadores">
    <meta name="theme-color" content="#ffd700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/pages/safari-fixes.css">
    <link rel="stylesheet" href="css/pages/dark-mode.css">
    <link rel="stylesheet" href="css/pages/ranking.css">
    
    <!-- SCRIPT DE MODO OSCURO GLOBAL -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('quiz-cristiano-theme');
            const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = savedTheme || systemPreference;
            
            document.documentElement.setAttribute('data-theme', theme);
            
            const metaThemeColor = document.querySelector('meta[name="theme-color"]');
            if (metaThemeColor) {
                metaThemeColor.content = theme === 'dark' ? '#000000' : '#ffd700';
            }
        })();
    </script>

    <!-- ADSENSE-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6335862771432698"
        crossorigin="anonymous"></script>
</head>
<body>
    <div class="ranking-container">
        <!-- Header -->
        <header class="ranking-header">
            <button class="back-btn" onclick="window.location.href='index.html'" title="Volver al inicio">
                <i class="fas fa-arrow-left"></i>
            </button>
            
            <div class="ranking-title">
                <h1>Ranking por Divisiones</h1>
                <p>Sistema competitivo por temporadas</p>
            </div>
            
            <div class="player-coins">
                <i class="fas fa-coins"></i>
                <span id="coins-display">0</span>
            </div>
        </header>

        <!-- ✅ NUEVA SECCIÓN: EXPLICACIÓN DEL SISTEMA -->
        <section class="system-explanation" id="system-explanation">
            <div class="explanation-header">
                <h2><i class="fas fa-info-circle"></i> ¿Cómo Funciona el Ranking?</h2>
                <button class="toggle-explanation" onclick="toggleExplanation()">
                    <i class="fas fa-chevron-down" id="explanation-icon"></i>
                </button>
            </div>
            
            <div class="explanation-content" id="explanation-content">
                <!-- Sistema de Puntuación -->
                <div class="explanation-section">
                    <h3><i class="fas fa-calculator"></i> Sistema de Puntuación Integral</h3>
                    <p>Tu puntaje se calcula combinando múltiples factores para premiar tanto la habilidad como la dedicación:</p>
                    
                    <div class="scoring-breakdown">
                        <div class="scoring-item">
                            <div class="scoring-icon activity">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div class="scoring-info">
                                <h4>Actividad (40%)</h4>
                                <p>Partidas jugadas este mes. Máximo: 100 partidas = 40 puntos</p>
                            </div>
                        </div>
                        
                        <div class="scoring-item">
                            <div class="scoring-icon victories">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="scoring-info">
                                <h4>Victorias (30%)</h4>
                                <p>Porcentaje de victorias. 100% victorias = 30 puntos</p>
                            </div>
                        </div>
                        
                        <div class="scoring-item">
                            <div class="scoring-icon achievements">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="scoring-info">
                                <h4>Logros (20%)</h4>
                                <p>Logros desbloqueados. Máximo: 50 logros = 20 puntos</p>
                            </div>
                        </div>
                        
                        <div class="scoring-item">
                            <div class="scoring-icon level">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="scoring-info">
                                <h4>Nivel (10%)</h4>
                                <p>Tu nivel actual. Nivel 100 = 10 puntos</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="formula-example">
                        <h4><i class="fas fa-equals"></i> Ejemplo de Cálculo</h4>
                        <div class="example-calculation">
                            <div class="calc-line">
                                <span>Actividad:</span> <span>50 partidas × 40% = 20 puntos</span>
                            </div>
                            <div class="calc-line">
                                <span>Victorias:</span> <span>75% × 30% = 22.5 puntos</span>
                            </div>
                            <div class="calc-line">
                                <span>Logros:</span> <span>25 logros × 20% = 10 puntos</span>
                            </div>
                            <div class="calc-line">
                                <span>Nivel:</span> <span>Nivel 60 × 10% = 6 puntos</span>
                            </div>
                            <div class="calc-total">
                                <span><strong>Total:</strong></span> <span><strong>58.5 puntos</strong></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Divisiones -->
                <div class="explanation-section">
                    <h3><i class="fas fa-layer-group"></i> Sistema de Divisiones</h3>
                    <p>Compite contra jugadores de tu mismo nivel en divisiones exclusivas:</p>
                    
                    <div class="divisions-info">
                        <div class="division-info-card platino">
                            <div class="division-trophy-info">
                                <img src="assets/images/Trofeos/Platino.png" alt="División Platino">
                            </div>
                            <div class="division-details">
                                <h4>División Platino</h4>
                                <p><strong>Requisito:</strong> Niveles 51-75</p>
                                <p><strong>Premios mensuales:</strong> 2,500 monedas</p>
                                <p><strong>Título:</strong> Experto Bíblico</p>
                            </div>
                        </div>
                        
                        <div class="division-info-card diamante">
                            <div class="division-trophy-info">
                                <img src="assets/images/Trofeos/Diamante.png" alt="División Diamante">
                            </div>
                            <div class="division-details">
                                <h4>División Diamante</h4>
                                <p><strong>Requisito:</strong> Niveles 76-100</p>
                                <p><strong>Premios mensuales:</strong> 5,000 monedas</p>
                                <p><strong>Título:</strong> Maestro Bíblico</p>
                            </div>
                        </div>
                        
                        <div class="division-info-card corona-divina">
                            <div class="division-trophy-info">
                                <img src="assets/images/Trofeos/corona-divina.png" alt="Corona Divina">
                            </div>
                            <div class="division-details">
                                <h4>Corona Divina</h4>
                                <p><strong>Requisito:</strong> Nivel 100+</p>
                                <p><strong>Premios mensuales:</strong> 10,000 monedas</p>
                                <p><strong>Título:</strong> Leyenda Bíblica</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Temporadas -->
                <div class="explanation-section">
                    <h3><i class="fas fa-calendar-alt"></i> Sistema de Temporadas</h3>
                    <div class="season-info">
                        <div class="season-item">
                            <div class="season-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="season-text">
                                <h4>Duración</h4>
                                <p>Cada temporada dura exactamente 30 días</p>
                            </div>
                        </div>
                        
                        <div class="season-item">
                            <div class="season-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="season-text">
                                <h4>Reset Mensual</h4>
                                <p>El primer día de cada mes comienza una nueva temporada</p>
                            </div>
                        </div>
                        
                        <div class="season-item">
                            <div class="season-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div class="season-text">
                                <h4>Premios del Top 3</h4>
                                <p>Los 3 mejores de cada división reciben premios especiales</p>
                            </div>
                        </div>
                        
                        <div class="season-item">
                            <div class="season-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="season-text">
                                <h4>Medallas Permanentes</h4>
                                <p>Las medallas ganadas se muestran para siempre en tu perfil</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consejos -->
                <div class="explanation-section">
                    <h3><i class="fas fa-lightbulb"></i> Consejos para Subir en el Ranking</h3>
                    <div class="tips-grid">
                        <div class="tip-card">
                            <i class="fas fa-play-circle"></i>
                            <h4>Juega Regularmente</h4>
                            <p>La actividad es el 40% de tu puntaje. Juega varias partidas al día.</p>
                        </div>
                        
                        <div class="tip-card">
                            <i class="fas fa-target"></i>
                            <h4>Mejora tu Precisión</h4>
                            <p>Las victorias cuentan 30%. Estudia para aumentar tu porcentaje de aciertos.</p>
                        </div>
                        
                        <div class="tip-card">
                            <i class="fas fa-trophy"></i>
                            <h4>Desbloquea Logros</h4>
                            <p>Los logros dan 20% del puntaje. Intenta completar todos los desafíos.</p>
                        </div>
                        
                        <div class="tip-card">
                            <i class="fas fa-arrow-up"></i>
                            <h4>Sube de Nivel</h4>
                            <p>El nivel contribuye 10%. Juega consistentemente para ganar experiencia.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mi División Actual -->
        <section class="my-division-section">
            <div class="division-card" data-division="platino" id="my-division-card">
                <div class="division-trophy">
                    <img src="assets/images/Trofeos/Platino.png" alt="División Platino" id="my-division-trophy">
                </div>
                <div class="division-info">
                    <h2 id="my-division-name">División Platino</h2>
                    <p id="my-division-description">Para expertos en conocimiento bíblico</p>
                    <div class="my-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="my-score">0</span>
                            <span class="stat-label">Puntos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="my-rank">#?</span>
                            <span class="stat-label">Posición</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="days-remaining">30</span>
                            <span class="stat-label">Días restantes</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sistema de Divisiones Overview -->
        <section class="divisions-overview">
            <h2><i class="fas fa-layer-group"></i> Todas las Divisiones</h2>
            <div class="divisions-grid" id="divisions-grid">
                <!-- Se cargan dinámicamente -->
            </div>
        </section>

        <!-- Ranking de Mi División -->
        <section class="division-ranking">
            <div class="ranking-header-section">
                <h2 id="division-ranking-title">Ranking División Platino</h2>
                <div class="season-info">
                    <i class="fas fa-calendar"></i>
                    <span id="season-info">Temporada 2025-06</span>
                </div>
            </div>
            
            <!-- Top 3 Podio -->
            <div class="podium-section">
                <div class="podium" id="division-podium">
                    <!-- Se llena dinámicamente -->
                </div>
            </div>
            
            <!-- Lista completa -->
            <div class="players-list" id="division-players-list">
                <div class="loading-players">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando ranking...</p>
                </div>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            <a href="single-player-new.html" class="nav-item">
                <i class="fas fa-play"></i>
                <span>Jugar</span>
            </a>
            <a href="ranking.html" class="nav-item active">
                <i class="fas fa-trophy"></i>
                <span>Ranking</span>
            </a>
            <a href="logros.html" class="nav-item">
                <i class="fas fa-medal"></i>
                <span>Logros</span>
            </a>
            <a href="store.html" class="nav-item">
                <i class="fas fa-store"></i>
                <span>Tienda</span>
            </a>
        </nav>
    </div>

    <!-- Scripts -->
    <script src="js/modules/gamedatamanager.js"></script>
    <script src="js/modules/dark-mode.js"></script>
    <script src="js/pages/ranking.js"></script>
    <script src="js/modules/ads-manager.js" type="module"></script>
    
    <!-- Script de inicialización -->
    <script>
        // Variables globales
        let currentRankingType = 'integral';
        let explanationExpanded = false;
        
        // ✅ NUEVA FUNCIÓN PARA ALTERNAR EXPLICACIÓN
        window.toggleExplanation = function() {
            const content = document.getElementById('explanation-content');
            const icon = document.getElementById('explanation-icon');
            
            explanationExpanded = !explanationExpanded;
            
            if (explanationExpanded) {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                
                // Animación suave
                setTimeout(() => {
                    content.style.opacity = '1';
                    content.style.maxHeight = '2000px';
                }, 10);
            } else {
                content.style.opacity = '0';
                content.style.maxHeight = '0';
                icon.style.transform = 'rotate(0deg)';
                
                setTimeout(() => {
                    content.style.display = 'none';
                }, 300);
            }
        };
        
        // Funciones globales para el HTML
        window.switchRanking = function(type) {
            if (typeof switchToRanking === 'function') {
                switchToRanking(type);
            }
        };
        
        window.refreshRanking = function() {
            if (typeof refreshCurrentRanking === 'function') {
                refreshCurrentRanking();
            }
        };
        
        window.loadMorePlayers = function() {
            if (typeof loadMorePlayersData === 'function') {
                loadMorePlayersData();
            }
        };
        
        window.closePlayerModal = function() {
            const modal = document.getElementById('player-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        };
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏆 Ranking HTML cargado con explicación del sistema');
            
            // Verificar elementos críticos
            const criticalElements = [
                'coins-display', 'division-podium', 'division-players-list',
                'my-division-card', 'divisions-grid', 'explanation-content'
            ];
            
            criticalElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`${element ? '✅' : '❌'} Elemento ${id}:`, !!element);
            });
        });
    </script>
</body>
</html>
